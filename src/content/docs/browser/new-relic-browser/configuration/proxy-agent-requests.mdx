---
title: Proxy agent chunk requests and analytics data
tags:
  - Browser monitoring
  - Proxy
metaDescription: "The agent can be configured to fetch its code and send analytics through a proxy server instead of New Relic's endpoints."
---

From [version 1.240.0](/docs/release-notes/new-relic-browser-release-notes/browser-agent-release-notes) and higher, the browser agent officially allows a proxy url to be set when determining either or both of:

1. Where to fetch or lazy-load agent code.
2. Where to send analytics.

Today, many ad-blockers and security VPNs block client requests to third-party domains including New Relic's. As the number of internet users opting into the use of ad-blockers increase, customers will continue to lose observability on those devices. One solution would be to proxy those requests though an unblocked middleman. For example, `yoursite.com` can send its visitor analytics through its `nrbeacon.yoursite.com` proxy which would not be blocked by anti-adware being that it's considered a first-party (sub)domain.

<Callout variant="important">
  This feature is currently available for those using the copy-and-paste _or_ NPM installation methods. There is currently no UI or NerdGraph configuration options available. We are continuing to work on improving access to these and other configuration options.
</Callout>

## How to use a proxy [#use]

The agent utilizes two configuration properties when determining where to fetch chunks or send data.

For example, using copy and paste:

```js
window.NREUM.init = {
    ...<other init properties>,
    proxy: {
        assets: <URL to fetch agent chunks>,
        beacon: <URL to send analytics>
    }
}
```

For NPM, similarly just pass the `init` object with a proxy as part of any other configurations:

```js
new BrowserAgent({ init: { proxy: <object similar to above> } })
```

`init.proxy.assets` is used verbatim in the copy-and-paste installation to fetch agent chunks.

* For example, the v1.240.0 Pro+SPA loader will require `nr-spa.___-1.240.min.js` file.
* If this field is set to be `nrassets.abc.com` reverse proxy, provide this value as the exact URL, including the scheme and ending slash: `'https://nrassets.abc.com/'`.

This is not relevant to NPM installed agents, as the main host project's bundler should take care of resources. `init.proxy.beacon` is used by both installation to determine the host to which data such as page view timings are sent. 

* For example, if those payloads are routed through a `nrbeacon.abc.com` proxy, then that is the exact string value to use. 
<Callout variant="important">
  * Note that the scheme (e.g, `'https://'`) and ending slash **should be omitted** for this property. The port, as part of the host, is accepted.
</Callout>


Paths can also be used:
```js
NREUM.init = {
    proxy: {
        assets: 'https://exampleproxy.com/chunks/',
        beacon: 'exampleproxy.com/ingest'
    }
}
```
<Callout variant="tip">
  The browser agent team recommends using different endpoints for your proxies.
</Callout>

## About your proxy server [#expectations]

The New Relic browser agent team provides neither a cloud proxy service nor support on such service application. **You must make and maintain your own proxy servers.**

To that effect, some assumptions are made about your proxy that must hold true for full functionality:

1. As mentioned above, if a proxy is used to load the agent chunk(s), it should fetch them from our CDN and pass it back to the client.
  a. Our current CDN is `https://js-agent.newrelic.com/`. E.g., for v1.240.0, requests to `https://yourproxy.com/nr-spa.3b61d78f-1.240.0.min.js` should yield the same response as from the upstream `https://js-agent.newrelic.com/nr-spa.3b61d78f-1.240.0.min.js`.
2. The beacon proxy forwards client payloads to New Relic.
  a. Your original endpoint can be found in your browser application settings page -- look for `;NREUM.info={beacon:"_____",...` in the copy snippet. For most apps, this would be `(https://)bam.nr-data.net`. However, it could be different for some customers for compliance and legal reasons.
  b. E.g., requests to `https://yourproxy.com/1/asdf?a=123` should be pass through to `https://bam.nr-data.net/1/asdf?a=123`.
3. Requests and responses through the proxy server should not be modified.
4. The client IP is passed in the `X-Forwarded-For` HTTP header from the proxy to New Relic servers. This is needed for the geolocation features in New Relic to work correctly.
  a. You can exclude this if user privacy is of concern. In the case that this field is missing, our geolocation will simply view your proxy's location as the "client".
5. Your system has the capability and capacity to handle the amount of bandwidth and traffic generated by analytics collection.
